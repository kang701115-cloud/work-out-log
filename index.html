<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Log</title>

<style>
  * { box-sizing: border-box; }

  body {
    font-family: system-ui, sans-serif;
    background: var(--bg);
    color: var(--text);
    margin:0; padding:20px;
    display:flex; justify-content:center;
  }

  /* LIGHT */
  :root {
    --bg:#f3f4f6;
    --card:#ffffff;
    --border:#d1d5db;
    --text:#111827;
    --accent:#2563eb;
    --content:#fafafa;
  }

  /* DARK */
  body.dark {
    --bg:#111827;
    --card:#1f2937;
    --border:#374151;
    --text:#f3f4f6;
    --accent:#3b82f6;
    --content:#1f2937;
  }

  .container {
    background:var(--card);
    border:1px solid var(--border);
    border-radius:16px;
    padding:20px;
    width:100%; max-width:620px;
    box-shadow:0 10px 30px rgba(0,0,0,0.15);
  }

  h1 {
    margin:0; display:flex;
    justify-content:space-between; align-items:center;
  }

  .toggle-btn { font-size:24px; cursor:pointer; }

  label { font-size:13px; color:#6b7280; display:block; margin-bottom:6px; }

  input, select {
    width:100%; padding:10px;
    border-radius:10px;
    border:1px solid var(--border);
    background:var(--card);
    color:var(--text);
    font-size:15px;
    margin-bottom:12px;
  }

  .inline { display:flex; gap:8px; }

  button {
    width:100%; padding:12px;
    border-radius:10px;
    font-weight:600; font-size:15px;
    border:none; cursor:pointer; margin-top:6px;
  }
  .primary { background:var(--accent); color:white; }
  .ghost { background:var(--card); border:1px solid var(--border); }

  .today-box {
    background:var(--card);
    border:1px solid var(--border);
    border-radius:10px;
    padding:12px;
    min-height:60px;
  }

  .record-date {
    background:#e0e7ff;
    border:1px solid #c7d2fe;
    padding:10px;
    margin-top:14px;
    border-radius:10px;
    font-weight:600;
    cursor:pointer;
    display:flex; justify-content:space-between;
  }

  .content {
    background:var(--content);
    border:1px solid var(--border);
    border-radius:10px;
    padding:10px;
    margin-top:6px;
    display:none;
  }

  .ex-group { margin-bottom:10px; }
  .ex-title { font-weight:600; margin-bottom:6px; }

  .line { display:flex; justify-content:space-between; margin-bottom:4px; }
  .edit { color:var(--accent); cursor:pointer; font-size:13px; }
  .del { color:#dc2626; margin-left:6px; cursor:pointer; font-size:13px; }
</style>
</head>

<body>
<div class="container">

  <h1>
    Workout Log
    <span id="themeToggle" class="toggle-btn">ğŸŒ™</span>
  </h1>

  <label>ë‚ ì§œ</label>
  <input type="date" id="dateInput">

  <h3 style="margin-top:20px;">ì˜¤ëŠ˜ ìš´ë™ ì…ë ¥</h3>

  <label>ìš´ë™ ì„ íƒ</label>
  <select id="exerciseSelect">
    <option>ìŠ¤ì¿¼íŠ¸</option>
    <option>ë ˆê·¸ ìµìŠ¤í…ì…˜</option>
    <option>ë¼ì‰ ë ˆê·¸ì»¬</option>
    <option>íŒ©ë± í”Œë¼ì´</option>
    <option>í¬ëŸ°ì¹˜</option>
    <option>ë ˆê·¸ ë ˆì´ì¦ˆ</option>
    <option>í”Œë­í¬</option>
    <option>ìŠ¤í…ë°€</option>
    <option>ì¸í„°ë²Œ ëŸ¬ë‹</option>
    <option value="custom">ê·¸ ì™¸ (ì§ì ‘ì…ë ¥)</option>
  </select>

  <div id="inputBox"></div>

  <button id="addBtn" class="primary">í‘œì— ì¶”ê°€</button>

  <h3 style="margin-top:20px;">ì˜¤ëŠ˜ ìš´ë™</h3>
  <div id="todayBox" class="today-box">ì•„ì§ ì—†ìŒ</div>
  <button id="clearBtn" class="ghost">ì˜¤ëŠ˜ ìš´ë™ ë¹„ìš°ê¸°</button>
  <button id="saveBtn" class="primary">ì˜¤ëŠ˜ ìš´ë™ ì €ì¥</button>

  <button id="backupBtn" class="ghost" style="margin-top:20px;">ë°±ì—…(JSON)</button>
  <button id="restoreOpenBtn" class="ghost">ë³µì›(JSON)</button>
  <input type="file" id="restoreInput" accept=".json" style="display:none">

  <h3 style="margin-top:20px;">ì €ì¥ëœ ìš´ë™</h3>
  <div id="logBox"></div>

</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

/* --------------------------------------
    ìƒíƒœ
-------------------------------------- */
let today = [];
let saved = JSON.parse(localStorage.getItem("workout_log") || "[]");
let editTarget = null;

dateInput.value = new Date().toISOString().split("T")[0];

const TYPES = {
  "ìŠ¤ì¿¼íŠ¸":"weight",
  "ë ˆê·¸ ìµìŠ¤í…ì…˜":"weight",
  "ë¼ì‰ ë ˆê·¸ì»¬":"weight",
  "íŒ©ë± í”Œë¼ì´":"weight",
  "í¬ëŸ°ì¹˜":"reps",
  "ë ˆê·¸ ë ˆì´ì¦ˆ":"reps",
  "í”Œë­í¬":"plank",
  "ìŠ¤í…ë°€":"time",
  "ì¸í„°ë²Œ ëŸ¬ë‹":"dist"
};

/* --------------------------------------
    í…Œë§ˆ
-------------------------------------- */
function applyTheme(t){
  if(t==="dark"){ document.body.classList.add("dark"); themeToggle.textContent="â˜€ï¸"; }
  else{ document.body.classList.remove("dark"); themeToggle.textContent="ğŸŒ™"; }
}
applyTheme(localStorage.getItem("theme") || "light");

themeToggle.onclick=()=>{
  const t=document.body.classList.contains("dark")?"light":"dark";
  localStorage.setItem("theme",t);
  applyTheme(t);
};

/* --------------------------------------
    ì…ë ¥ UI ìƒì„±
-------------------------------------- */
function renderInputs(){
  const type = TYPES[exerciseSelect.value];
  const box = document.getElementById("inputBox");

  if(exerciseSelect.value==="custom"){
    box.innerHTML = `
      <label>ìš´ë™ëª…</label><input id="c_name">
      <label>ì¤‘ëŸ‰/ì„¸íŠ¸/íšŸìˆ˜</label>
      <div class="inline">
        <input id="c_w" type="number" placeholder="kg">
        <input id="c_s" type="number" placeholder="ì„¸íŠ¸">
        <input id="c_r" type="number" placeholder="íšŸìˆ˜">
      </div>
      <label>ê±°ë¦¬(km)</label><input id="c_d" type="number">
      <label>ì‹œê°„(ë¶„,ì´ˆ)</label>
      <div class="inline">
        <input id="c_m" type="number" placeholder="ë¶„">
        <input id="c_sec" type="number" placeholder="ì´ˆ">
      </div>
    `;
    return;
  }

  if(type==="weight"){
    box.innerHTML = `
      <label>ì¤‘ëŸ‰/ì„¸íŠ¸/íšŸìˆ˜</label>
      <div class="inline">
        <input id="w" type="number" placeholder="kg">
        <input id="s" type="number" placeholder="ì„¸íŠ¸">
        <input id="r" type="number" placeholder="íšŸìˆ˜">
      </div>
    `;
  }
  if(type==="reps"){
    box.innerHTML = `
      <label>ì„¸íŠ¸/íšŸìˆ˜</label>
      <div class="inline">
        <input id="s" type="number">
        <input id="r" type="number">
      </div>
    `;
  }
  if(type==="plank"){
    box.innerHTML = `
      <label>ì„¸íŠ¸/ì´ˆ</label>
      <div class="inline">
        <input id="s" type="number">
        <input id="sec" type="number">
      </div>
    `;
  }
  if(type==="time"){
    box.innerHTML = `
      <label>ì‹œê°„(ë¶„)</label><input id="time" type="number">
      <label>ë©”ëª¨</label><input id="memo">
    `;
  }
  if(type==="dist"){
    box.innerHTML = `
      <label>ê±°ë¦¬(km)</label><input id="dist" type="number">
      <label>ë©”ëª¨</label><input id="memo">
    `;
  }
}
renderInputs();
exerciseSelect.onchange = renderInputs;

/* --------------------------------------
    í¬ë§· í•¨ìˆ˜
-------------------------------------- */
function fmt(e){
  let out=e.ex+" â€” ";
  if(e.custom){
    if(e.weight) out+=`${e.weight}kg `;
    if(e.sets&&e.reps) out+=`${e.sets}Ã—${e.reps} `;
    if(e.dist) out+=`${e.dist}km `;
    if(e.min) out+=`${e.min}ë¶„ `;
    if(e.sec) out+=`${e.sec}ì´ˆ `;
    return out.trim();
  }
  if(e.type==="weight") out+=`${e.weight}kg ${e.sets}Ã—${e.reps}`;
  if(e.type==="reps") out+=`${e.sets}Ã—${e.reps}`;
  if(e.type==="plank") out+=`${e.sets}Ã—${e.sec}ì´ˆ`;
  if(e.type==="time") out+=`${e.time}ë¶„${e.memo?` (${e.memo})`:""}`;
  if(e.type==="dist") out+=`${e.dist}km${e.memo?` (${e.memo})`:""}`;
  return out;
}

/* --------------------------------------
    ì˜¤ëŠ˜ í‘œì‹œ
-------------------------------------- */
function renderToday(){
  const box=todayBox;
  if(!today.length){
    box.textContent="ì•„ì§ ì—†ìŒ";
    return;
  }
  box.innerHTML = today.map(x=>`<div>${fmt(x)}</div>`).join("");
}

/* --------------------------------------
    ì¶”ê°€ ë²„íŠ¼
-------------------------------------- */
addBtn.onclick=()=>{
  const sel = exerciseSelect.value;
  let e={};

  if(sel==="custom"){
    e.custom=true;
    e.ex=c_name.value.trim();
    e.weight=+c_w.value||null;
    e.sets=+c_s.value||null;
    e.reps=+c_r.value||null;
    e.dist=+c_d.value||null;
    e.min=+c_m.value||null;
    e.sec=+c_sec.value||null;
  } else {
    const type=TYPES[sel];
    e.ex=sel; e.type=type;

    if(type==="weight"){
      e.weight=+w.value; e.sets=+s.value; e.reps=+r.value;
    }
    if(type==="reps"){
      e.sets=+s.value; e.reps=+r.value;
    }
    if(type==="plank"){
      e.sets=+s.value; e.sec=+sec.value;
    }
    if(type==="time"){
      e.time=+time.value; e.memo=memo.value.trim();
    }
    if(type==="dist"){
      e.dist=+dist.value; e.memo=memo.value.trim();
    }
  }

  if(editTarget){
    saved[editTarget.d].items[editTarget.i]=e;
    editTarget=null;
    addBtn.textContent="í‘œì— ì¶”ê°€";
    saveLog();
    renderSaved();
    return;
  }

  today.push(e);
  renderToday();
  renderInputs();
};

/* --------------------------------------
    ì˜¤ëŠ˜ ë¹„ìš°ê¸°
-------------------------------------- */
clearBtn.onclick=()=>{ today=[]; renderToday(); };

/* --------------------------------------
    ì €ì¥
-------------------------------------- */
saveBtn.onclick=()=>{
  if(!today.length) return alert("ì—†ìŒ");

  const d=dateInput.value;
  let ex=saved.find(x=>x.date===d);
  if(ex) ex.items.push(...today);
  else saved.push({date:d,items:[...today]});

  today=[];
  renderToday();
  saveLog();
  renderSaved();
};

function saveLog(){
  localStorage.setItem("workout_log",JSON.stringify(saved));
}

/* --------------------------------------
    ê¸°ë¡ ë Œë”
-------------------------------------- */
function renderSaved(){
  logBox.innerHTML="";
  if(!saved.length){
    logBox.innerHTML="<div style='color:#6b7280'>ê¸°ë¡ ì—†ìŒ</div>";
    return;
  }

  [...saved].sort((a,b)=>b.date.localeCompare(a.date)).forEach((s,di)=>{
    let head=document.createElement("div");
    head.className="record-date";
    head.innerHTML=`${s.date}<span>â–¶</span>`;

    let cont=document.createElement("div");
    cont.className="content";

    const groups={};
    s.items.forEach((e,ii)=>{
      if(!groups[e.ex]) groups[e.ex]=[];
      groups[e.ex].push({e,ii});
    });

    Object.keys(groups).forEach(name=>{
      let g=document.createElement("div");
      g.className="ex-group";
      g.innerHTML=`<div class="ex-title">${name}</div>`;

      groups[name].forEach(o=>{
        let line=document.createElement("div");
        line.className="line";
        line.innerHTML=`
          <span>${fmt(o.e)}</span>
          <span>
            <span class="edit" onclick="editEntry(${di},${o.ii})">ìˆ˜ì •</span>
            <span class="del" onclick="delEntry(${di},${o.ii})">ì‚­ì œ</span>
          </span>`;
        g.appendChild(line);
      });

      cont.appendChild(g);
    });

    head.onclick=()=>{
      const open=cont.style.display==="block";
      cont.style.display=open?"none":"block";
      head.querySelector("span").textContent=open?"â–¶":"â–¼";
    };

    logBox.appendChild(head);
    logBox.appendChild(cont);
  });
}
renderSaved();

/* --------------------------------------
    ìˆ˜ì • / ì‚­ì œ
-------------------------------------- */
window.editEntry=(d,i)=>{
  const e=saved[d].items[i];
  editTarget={d,i};
  exerciseSelect.value=e.custom?"custom":e.ex;
  renderInputs();

  if(e.custom){
    c_name.value=e.ex;
    c_w.value=e.weight||"";
    c_s.value=e.sets||"";
    c_r.value=e.reps||"";
    c_d.value=e.dist||"";
    c_m.value=e.min||"";
    c_sec.value=e.sec||"";
  } else {
    const t=e.type;
    if(t==="weight"){ w.value=e.weight; s.value=e.sets; r.value=e.reps; }
    if(t==="reps"){ s.value=e.sets; r.value=e.reps; }
    if(t==="plank"){ s.value=e.sets; sec.value=e.sec; }
    if(t==="time"){ time.value=e.time; memo.value=e.memo||""; }
    if(t==="dist"){ dist.value=e.dist; memo.value=e.memo||""; }
  }

  addBtn.textContent="ìˆ˜ì • ì €ì¥";
};

window.delEntry=(d,i)=>{
  if(!confirm("ì‚­ì œ?")) return;
  saved[d].items.splice(i,1);
  if(!saved[d].items.length) saved.splice(d,1);
  saveLog();
  renderSaved();
};

/* --------------------------------------
    ë°±ì—… / ë³µì›
-------------------------------------- */
backupBtn.onclick=()=>{
  const blob=new Blob([JSON.stringify({saved},null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="backup.json";
  a.click();
};

restoreOpenBtn.onclick=()=>restoreInput.click();

restoreInput.onchange=e=>{
  const file=e.target.files[0];
  const r=new FileReader();
  r.onload=()=>{
    try{
      saved=JSON.parse(r.result).saved||[];
      saveLog(); renderSaved();
      alert("ë³µì› ì™„ë£Œ!");
    }catch{
      alert("ì˜¤ë¥˜ë‚œ JSON");
    }
  };
  r.readAsText(file);
};

});
</script>

</body>
</html>
