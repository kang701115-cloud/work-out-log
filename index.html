<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>workout Log.</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2563eb">

  <style>
    * { box-sizing: border-box; transition: background 0.25s, color 0.25s, border-color 0.25s; }

    body {
      margin:0; padding:20px;
      font-family: system-ui,-apple-system,"Segoe UI",sans-serif;
      background: var(--bg);
      color: var(--text);
      display:flex; justify-content:center;
    }

    /* --- Light Theme --- */
    :root {
      --bg: #f3f4f6;
      --card: #ffffff;
      --border: #d1d5db;
      --text: #111827;
      --subtext: #374151;
      --accent: #2563eb;
      --accordion-bg: #eef2ff;
      --accordion-border: #c7d2fe;
      --content-bg: #fafafa;
    }

    /* --- Dark Theme --- */
    body.dark {
      --bg: #111827;
      --card: #1f2937;
      --border: #374151;
      --text: #f3f4f6;
      --subtext: #9ca3af;
      --accent: #3b82f6;
      --accordion-bg: #1e3a8a;
      --accordion-border: #3b82f6;
      --content-bg: #1f2937;
    }

    .container {
      width:100%; max-width:620px;
      background: var(--card);
      border-radius:12px;
      padding:20px;
      box-shadow:0 16px 28px rgba(0,0,0,0.12);
      color: var(--text);
      border:1px solid var(--border);
    }

    h1 {
      margin:0; font-size:22px; font-weight:700;
      display:flex; justify-content:space-between; align-items:center;
    }

    .toggle-btn {
      cursor:pointer;
      font-size:20px;
      user-select:none;
    }

    label { font-size:12px; color: var(--subtext); }
    input, select {
      width:100%; padding:8px;
      border-radius:10px;
      border:1px solid var(--border);
      font-size:13px;
      background:var(--card);
      color:var(--text);
    }

    .inline-group { display:flex; gap:6px; }
    .section-title { margin-top:20px; font-weight:600; }

    button {
      border:none; border-radius:10px;
      padding:10px; font-size:14px; font-weight:600;
      cursor:pointer; width:100%;
    }
    .btn-primary { background:var(--accent); color:white; }
    .btn-ghost { background:var(--card); border:1px solid var(--border); color:var(--text); }

    .accordion-date {
      background:var(--accordion-bg);
      border:1px solid var(--accordion-border);
      padding:10px 14px;
      border-radius:10px;
      margin-top:12px;
      font-weight:600;
      cursor:pointer;
      display:flex; justify-content:space-between; align-items:center;
      color: var(--text);
    }

    .accordion-content {
      display:none; flex-direction:column;
      gap:8px; background:var(--content-bg);
      border:1px solid var(--border);
      border-radius:10px;
      padding:12px;
    }

    .exercise-group {
      background:var(--card);
      border:1px solid var(--border);
      border-radius:8px;
      padding:8px 10px;
      color: var(--text);
    }

    .exercise-title { font-weight:600; margin-bottom:6px; }
    .exercise-line {
      display:flex; justify-content:space-between; align-items:center; color: var(--text);
    }
    .edit-btn { color:var(--accent); cursor:pointer; font-size:12px; }
    .delete-btn { color:#dc2626; cursor:pointer; font-size:12px; margin-left:8px; }
  </style>
</head>

<body>
<div class="container">

  <h1>
    Workout Log
    <span class="toggle-btn" id="themeToggle">ğŸŒ™</span>
  </h1>
  <!-- ë‚ ì§œ ì…ë ¥ -->
  <label style="margin-top:12px;">ë‚ ì§œ</label>
  <input type="date" id="dateInput" style="margin-bottom:14px">

  <!-- ìš´ë™ ì…ë ¥ -->
  <div class="section-title">ì˜¤ëŠ˜ ìš´ë™ ì…ë ¥</div>
  <div style="background:var(--content-bg); padding:14px; border-radius:12px; border:1px solid var(--border);">

    <label>ìš´ë™ ì„ íƒ</label>
    <select id="exerciseSelect" style="margin-bottom:10px;">
      <option>ìŠ¤ì¿¼íŠ¸</option>
      <option>ë ˆê·¸ ìµìŠ¤í…ì…˜</option>
      <option>ë¼ì‰ ë ˆê·¸ì»¬</option>
      <option>íŒ©ë± í”Œë¼ì´</option>
      <option>í¬ëŸ°ì¹˜</option>
      <option>ë ˆê·¸ ë ˆì´ì¦ˆ</option>
      <option>í”Œë­í¬</option>
      <option>ìŠ¤í…ë°€</option>
      <option>ì¸í„°ë²Œ ëŸ¬ë‹</option>
      <option value="custom">ê·¸ ì™¸ ìš´ë™ (ì§ì ‘ ì…ë ¥)</option>
    </select>

    <div id="dynamicInputs"></div>

    <button class="btn-primary" id="addEntryBtn" style="margin-top:10px;">í‘œì— ì¶”ê°€</button>
  </div>

  <!-- ì˜¤ëŠ˜ ìš´ë™ ì¶œë ¥ -->
  <div class="section-title">ì˜¤ëŠ˜ ìš´ë™</div>
  <div id="todayArea" style="min-height:50px; background:var(--card); border:1px solid var(--border); border-radius:10px; padding:10px;">
    ì•„ì§ ì¶”ê°€ëœ ìš´ë™ ì—†ìŒ
  </div>

  <button class="btn-ghost" id="clearTodayBtn" style="margin-top:10px;">ì˜¤ëŠ˜ ìš´ë™ ë¹„ìš°ê¸°</button>
  <button class="btn-primary" id="finishDayBtn" style="margin-top:6px;">ì˜¤ëŠ˜ ìš´ë™ ì €ì¥</button>

  <!-- ë°±ì—… ë³µì› -->
  <button class="btn-ghost" id="backupBtn" style="margin-top:16px;">ë°±ì—…(JSON)</button>
  <button class="btn-ghost" id="restoreBtn" style="margin-top:6px;">ë³µì›(JSON)</button>
  <input type="file" id="restoreInput" accept=".json" style="display:none">

  <div class="section-title" style="margin-top:24px;">ì €ì¥ëœ ìš´ë™ ê¸°ë¡</div>
  <div id="logAccordion"></div>

</div> <!-- container end -->

<script>
/* ================================
   ìƒíƒœ ë³€ìˆ˜
================================ */
let todayEntries = [];
let saved = [];
let editTarget = null;
const STORAGE_KEY = "workout_log_single";
const THEME_KEY = "workout_theme";

/* ================================
   ê¸°ë³¸ ë‚ ì§œ
================================ */
dateInput.value = new Date().toISOString().split("T")[0];

/* ================================
   ìš´ë™ ê·œì¹™
================================ */
const CONFIG = {
  "ìŠ¤ì¿¼íŠ¸":"weight",
  "ë ˆê·¸ ìµìŠ¤í…ì…˜":"weight",
  "ë¼ì‰ ë ˆê·¸ì»¬":"weight",
  "íŒ©ë± í”Œë¼ì´":"weight",
  "í¬ëŸ°ì¹˜":"repsOnly",
  "ë ˆê·¸ ë ˆì´ì¦ˆ":"repsOnly",
  "í”Œë­í¬":"plank",
  "ìŠ¤í…ë°€":"time",
  "ì¸í„°ë²Œ ëŸ¬ë‹":"distanceOnly"
};

/* ================================
   ë‹¤í¬ëª¨ë“œ ë¡œë”©
================================ */
function applyTheme(theme) {
  if (theme === "dark") {
    document.body.classList.add("dark");
    themeToggle.textContent = "â˜€ï¸";
  } else {
    document.body.classList.remove("dark");
    themeToggle.textContent = "ğŸŒ™";
  }
}

const savedTheme = localStorage.getItem(THEME_KEY) || "light";
applyTheme(savedTheme);

/* í† ê¸€ í´ë¦­ ì´ë²¤íŠ¸ */
themeToggle.onclick = () => {
  const newTheme = document.body.classList.contains("dark") ? "light" : "dark";
  localStorage.setItem(THEME_KEY, newTheme);
  applyTheme(newTheme);
};

/* ================================
   ë™ì  ì…ë ¥ì¹¸ ë Œë”ë§
================================ */
function renderDynamicInputs() {
  const type = CONFIG[exerciseSelect.value];
  const box = dynamicInputs;

  if (exerciseSelect.value === "custom") {
    box.innerHTML = `
      <label>ìš´ë™ëª…</label>
      <input id="c_name" type="text" placeholder="ìš´ë™ ì´ë¦„ ì…ë ¥">

      <label style="margin-top:8px;">ì¤‘ëŸ‰ / ì„¸íŠ¸ / íšŸìˆ˜</label>
      <div class="inline-group">
        <input id="c_weight" type="number" placeholder="kg">
        <input id="c_sets" type="number" placeholder="ì„¸íŠ¸">
        <input id="c_reps" type="number" placeholder="íšŸìˆ˜">
      </div>

      <label style="margin-top:8px;">ê±°ë¦¬(km)</label>
      <input id="c_dist" type="number" placeholder="km">

      <label style="margin-top:8px;">ì‹œê°„</label>
      <div class="inline-group">
        <input id="c_min" type="number" placeholder="ë¶„">
        <input id="c_sec" type="number" placeholder="ì´ˆ">
      </div>
    `;
    return;
  }

  if (type === "weight") {
    box.innerHTML = `
      <label>ì¤‘ëŸ‰ / ì„¸íŠ¸ / íšŸìˆ˜</label>
      <div class="inline-group">
        <input id="weight" type="number" placeholder="kg">
        <input id="sets" type="number" placeholder="ì„¸íŠ¸">
        <input id="reps" type="number" placeholder="íšŸìˆ˜">
      </div>`;
  }
  else if (type === "repsOnly") {
    box.innerHTML = `
      <label>ì„¸íŠ¸ / íšŸìˆ˜</label>
      <div class="inline-group">
        <input id="sets" type="number" placeholder="ì„¸íŠ¸">
        <input id="reps" type="number" placeholder="íšŸìˆ˜">
      </div>`;
  }
  else if (type === "plank") {
    box.innerHTML = `
      <label>ì„¸íŠ¸ / ì´ˆ</label>
      <div class="inline-group">
        <input id="sets" type="number" placeholder="ì„¸íŠ¸">
        <input id="seconds" type="number" placeholder="ì´ˆ">
      </div>`;
  }
  else if (type === "time") {
    box.innerHTML = `
      <label>ì‹œê°„(ë¶„)</label>
      <input id="time" type="number" placeholder="ë¶„">

      <label style="margin-top:8px;">ë©”ëª¨ (ì„ íƒ)</label>
      <input id="memo" type="text" placeholder="ë©”ëª¨ ì…ë ¥">
    `;
  }
  else if (type === "distanceOnly") {
    box.innerHTML = `
      <label>ê±°ë¦¬(km)</label>
      <input id="distance" type="number" placeholder="km">

      <label style="margin-top:8px;">ë©”ëª¨ (ì„ íƒ)</label>
      <input id="memo" type="text" placeholder="ë©”ëª¨ ì…ë ¥">
    `;
  }
}
renderDynamicInputs();
exerciseSelect.onchange = renderDynamicInputs;

/* ================================
   ì¶”ê°€ ë²„íŠ¼
================================ */
addEntryBtn.onclick = () => {
  const selected = exerciseSelect.value;
  let entry = {};

  if (selected === "custom") {
    entry.ex = c_name.value.trim();
    if (!entry.ex) return alert("ìš´ë™ëª… í•„ìˆ˜");

    entry.custom = true;
    entry.weight = +c_weight.value || null;
    entry.sets = +c_sets.value || null;
    entry.reps = +c_reps.value || null;
    entry.dist = +c_dist.value || null;
    entry.timeMin = +c_min.value || null;
    entry.timeSec = +c_sec.value || null;
  }
  else {
    const type = CONFIG[selected];
    entry.ex = selected;
    entry.type = type;

    if (type === "weight") {
      entry.weight = +weight.value;
      entry.sets = +sets.value;
      entry.reps = +reps.value;
      if (!entry.weight || !entry.sets || !entry.reps)
        return alert("í•„ìˆ˜ê°’ ì…ë ¥ í•„ìš”");
    }

    if (type === "repsOnly") {
      entry.sets = +sets.value;
      entry.reps = +reps.value;
      if (!entry.sets || !entry.reps)
        return alert("í•„ìˆ˜ê°’ ì…ë ¥ í•„ìš”");
    }

    if (type === "plank") {
      entry.sets = +sets.value;
      entry.seconds = +seconds.value;
      if (!entry.sets || !entry.seconds)
        return alert("í•„ìˆ˜ê°’ ì…ë ¥ í•„ìš”");
    }

    if (type === "time") {
      entry.time = +time.value;
      entry.memo = memo.value.trim() || "";
      if (!entry.time) return alert("ì‹œê°„ ì…ë ¥ í•„ìš”");
    }

    if (type === "distanceOnly") {
      entry.dist = +distance.value;
      entry.memo = memo.value.trim() || "";
      if (!entry.dist) return alert("ê±°ë¦¬ ì…ë ¥ í•„ìš”");
    }
  }

  if (editTarget) {
    saved[editTarget.di].items[editTarget.ii] = entry;
    editTarget = null;
    addEntryBtn.textContent = "í‘œì— ì¶”ê°€";
    saveLocal();
    renderSaved();
    return;
  }

  todayEntries.push(entry);
  renderToday();
  renderDynamicInputs();
};

/* ================================
   ì˜¤ëŠ˜ ìš´ë™ ì¶œë ¥
================================ */
function renderToday() {
  if (!todayEntries.length) {
    todayArea.textContent = "ì•„ì§ ì¶”ê°€ëœ ìš´ë™ ì—†ìŒ";
    return;
  }
  todayArea.innerHTML = todayEntries.map(e => `<div>${formatEntry(e)}</div>`).join("");
}

/* ================================
   formatEntry
================================ */
function formatEntry(e) {
  let out = e.ex + " â€” ";

  if (e.custom) {
    if (e.weight) out += `${e.weight}kg `;
    if (e.sets && e.reps) out += `${e.sets}Ã—${e.reps} `;
    if (e.dist) out += `${e.dist}km `;
    if (e.timeMin) out += `${e.timeMin}ë¶„ `;
    if (e.timeSec) out += `${e.timeSec}ì´ˆ `;
    return out.trim();
  }

  if (e.type === "weight") out += `${e.weight}kg ${e.sets}Ã—${e.reps}`;
  if (e.type === "repsOnly") out += `${e.sets}Ã—${e.reps}`;
  if (e.type === "plank") out += `${e.sets}Ã—${e.seconds}ì´ˆ`;
  if (e.type === "time") out += `${e.time}ë¶„`;
  if (e.type === "distanceOnly") out += `${e.dist}km`;

  if (e.memo) out += ` (${e.memo})`;

  return out;
}

/* ================================
   ì˜¤ëŠ˜ ì €ì¥
================================ */
finishDayBtn.onclick = () => {
  if (!todayEntries.length) return alert("ìš´ë™ ì—†ìŒ");

  const date = dateInput.value;
  let exist = saved.find(x => x.date === date);

  if (exist) exist.items.push(...todayEntries);
  else saved.push({ date, items: [...todayEntries] });

  todayEntries = [];
  renderToday();
  saveLocal();
  renderSaved();
};

/* ================================
   ë¡œì»¬ ì €ì¥
================================ */
function saveLocal() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(saved));
}
function loadLocal() {
  saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
}
loadLocal();

/* ================================
   ê¸°ë¡ ë Œë”
================================ */
function renderSaved() {
  logAccordion.innerHTML = "";

  if (!saved.length) {
    logAccordion.innerHTML = `<div style="color:var(--subtext)">ê¸°ë¡ ì—†ìŒ</div>`;
    return;
  }

  [...saved].sort((a,b)=>b.date.localeCompare(a.date))
  .forEach((session, di) => {

    const head = document.createElement("div");
    head.className = "accordion-date";
    head.innerHTML = `${session.date}<span>â–¶</span>`;

    const content = document.createElement("div");
    content.className = "accordion-content";

    const groups = {};
    session.items.forEach((e, ii) => {
      if (!groups[e.ex]) groups[e.ex] = [];
      groups[e.ex].push({ entry:e, realIndex:ii });
    });

    Object.keys(groups).forEach(name => {
      const wrap = document.createElement("div");
      wrap.className = "exercise-group";
      wrap.innerHTML = `<div class="exercise-title">${name}</div>`;

      groups[name].forEach(obj => {
        const e = obj.entry;
        const line = document.createElement("div");
        line.className = "exercise-line";
        line.innerHTML = `
          <span>${formatEntry(e)}</span>
          <span>
            <span class="edit-btn" onclick="editEntry(${di},${obj.realIndex})">ìˆ˜ì •</span>
            <span class="delete-btn" onclick="deleteEntry(${di},${obj.realIndex})">ì‚­ì œ</span>
          </span>
        `;
        wrap.appendChild(line);
      });

      content.appendChild(wrap);
    });

    head.onclick = () => {
      const open = content.style.display === "flex";
      content.style.display = open ? "none" : "flex";
      head.querySelector("span").textContent = open ? "â–¶" : "â–¼";
    };

    logAccordion.appendChild(head);
    logAccordion.appendChild(content);
  });
}
renderSaved();

/* ================================
   ìˆ˜ì •
================================ */
function editEntry(di, ii) {
  editTarget = { di, ii };
  const e = saved[di].items[ii];

  exerciseSelect.value = e.custom ? "custom" : e.ex;
  renderDynamicInputs();

  if (e.custom) {
    c_name.value = e.ex;
    c_weight.value = e.weight || "";
    c_sets.value = e.sets || "";
    c_reps.value = e.reps || "";
    c_dist.value = e.dist || "";
    c_min.value = e.timeMin || "";
    c_sec.value = e.timeSec || "";
  } else {
    if (e.type === "weight") {
      weight.value = e.weight;
      sets.value = e.sets;
      reps.value = e.reps;
    }
    if (e.type === "repsOnly") {
      sets.value = e.sets;
      reps.value = e.reps;
    }
    if (e.type === "plank") {
      sets.value = e.sets;
      seconds.value = e.seconds;
    }
    if (e.type === "time") {
      time.value = e.time;
      memo.value = e.memo || "";
    }
    if (e.type === "distanceOnly") {
      distance.value = e.dist;
      memo.value = e.memo || "";
    }
  }

  addEntryBtn.textContent = "ìˆ˜ì • ì €ì¥";
}

/* ================================
   ì‚­ì œ
================================ */
function deleteEntry(di, ii) {
  if (!confirm("ì‚­ì œí• ê¹Œìš”?")) return;
  saved[di].items.splice(ii, 1);
  if (!saved[di].items.length) saved.splice(di, 1);
  saveLocal();
  renderSaved();
}

/* ================================
   ë°±ì—… / ë³µì›
================================ */
backupBtn.onclick = () => {
  const blob = new Blob([JSON.stringify({ saved }, null, 2)], { type:"application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "workout_backup.json";
  a.click();
  URL.revokeObjectURL(url);
};

restoreBtn.onclick = () => restoreInput.click();

restoreInput.onchange = e => {
  const file = e.target.files[0];
  const reader = new FileReader();

  reader.onload = () => {
    try {
      saved = JSON.parse(reader.result).saved || [];
      saveLocal();
      renderSaved();
      alert("ë³µì› ì™„ë£Œ!");
    } catch {
      alert("JSON ì˜¤ë¥˜");
    }
  };
  reader.readAsText(file);
};

/* ================================
   PWA
================================ */
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/service-worker.js").then(() => {
    console.log("Service Worker Registered");
  });
}
</script>


