<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìš´ë™ ê¸°ë¡ - ì•ˆì • ì €ì¥ ë²„ì „</title>

  <style>
    *{box-sizing:border-box}
    body{
      margin:0;padding:20px;
      font-family:system-ui,-apple-system,"Segoe UI",sans-serif;
      background:#f3f4f6;
      display:flex;justify-content:center;
    }
    .container{
      width:100%;max-width:600px;
      background:#fff;border-radius:12px;
      padding:18px 20px 28px;
      box-shadow:0 16px 28px rgba(0,0,0,0.12);
      border:1px solid #e5e7eb;
    }
    h1{margin:0;color:#111827;font-size:22px}
    .subtitle{font-size:13px;color:#6b7280;margin-bottom:16px}

    label{font-size:12px;color:#374151}
    input,select{
      width:100%;border-radius:10px;
      border:1px solid #d1d5db;background:#fff;
      padding:8px;font-size:13px;
    }
    input:focus,select:focus{
      border-color:#2563eb;
      box-shadow:0 0 0 1px rgba(37,99,235,0.2);
      outline:none;
    }

    .section-title{margin-top:20px;margin-bottom:6px;font-weight:600}

    .card{
      background:#f9fafb;border:1px solid #e5e7eb;
      border-radius:12px;padding:14px;
    }
    .form-grid{
      display:grid;grid-template-columns:1fr 1fr;
      gap:12px;align-items:flex-end
    }
    .inline-group{display:flex;gap:6px}

    button{
      border:none;border-radius:10px;
      padding:10px;font-size:14px;
      font-weight:600;cursor:pointer;width:100%;
    }
    .btn-primary{background:#2563eb;color:#fff}
    .btn-primary:hover{background:#1d4ed8}
    .btn-ghost{background:#f9fafb;border:1px solid #d1d5db}
    .btn-danger{
      background:#fee2e2;color:#b91c1c;
      border:1px solid #fecaca;padding:6px;font-size:12px;
    }

    /* ì•„ì½”ë””ì–¸ */
    .accordion-date{
      padding:10px 14px;background:#eef2ff;
      border:1px solid #c7d2fe;border-radius:10px;
      font-weight:600;color:#1e3a8a;
      display:flex;justify-content:space-between;
      align-items:center;cursor:pointer;
    }
    .accordion-content{
      display:none;flex-direction:column;
      gap:8px;padding:12px;
      background:#fafafa;border:1px solid #e5e7eb;
      border-radius:10px;font-size:13px;
    }
    .exercise-group{
      background:#fff;border:1px solid #e5e7eb;
      border-radius:8px;padding:8px 10px;
    }
    .exercise-title{
      font-weight:600;margin-bottom:4px;
      color:#111827;font-size:14px;
    }
    .exercise-line{font-size:13px;color:#374151;margin-left:8px}

    @media(max-width:480px){
      .form-grid{grid-template-columns:1fr}
      .inline-group{flex-direction:column}
      button{width:100%}
    }
  </style>
</head>

<body>
<div class="container">

  <h1>ìš´ë™ ê¸°ë¡</h1>
  <div class="subtitle">ëª¨ë°”ì¼ ìµœì í™” + ê·¸ë£¹í™” + ì˜êµ¬ ì €ì¥</div>

  <label>ë‚ ì§œ</label>
  <input type="date" id="dateInput" style="margin-bottom:14px">

  <!-- ì…ë ¥ ì˜ì—­ -->
  <div class="section-title">ì˜¤ëŠ˜ ìš´ë™ ì…ë ¥</div>
  <div class="card">
    <div class="form-grid">
      <div>
        <label>ìš´ë™ ì„ íƒ</label>
        <select id="exerciseSelect">
          <option>ìŠ¤ì¿¼íŠ¸</option>
          <option>ë ˆê·¸ ìµìŠ¤í…ì…˜</option>
          <option>ë¼ì‰ ë ˆê·¸ì»¬</option>
          <option>íŒ©ë± í”Œë¼ì´</option>
          <option>í¬ëŸ°ì¹˜</option>
          <option>ë ˆê·¸ ë ˆì´ì¦ˆ</option>
          <option>í”Œë­í¬</option>
          <option>ìŠ¤í…ë°€</option>
          <option>ì¸í„°ë²Œ ëŸ¬ë‹</option>
        </select>
      </div>
      <div id="dynamicInputs"></div>
    </div>

    <div style="margin-top:10px;display:flex;flex-direction:column;gap:8px">
      <button class="btn-ghost" id="clearCurrentBtn">ì…ë ¥ ì´ˆê¸°í™”</button>
      <button class="btn-primary" id="addEntryBtn">í‘œì— ì¶”ê°€</button>
    </div>
  </div>

  <!-- ì˜¤ëŠ˜ ìš´ë™ í‘œì‹œ -->
  <div class="section-title">ì˜¤ëŠ˜ ìš´ë™</div>
  <div id="todayArea" style="background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:10px;min-height:46px;font-size:14px;color:#374151">
    ì•„ì§ ì¶”ê°€ëœ ìš´ë™ ì—†ìŒ
  </div>

  <div style="margin-top:10px;display:flex;flex-direction:column;gap:8px;">
    <button class="btn-ghost" id="clearTodayBtn">ì˜¤ëŠ˜ ìš´ë™ ë¹„ìš°ê¸°</button>
    <button class="btn-primary" id="finishDayBtn">ì˜¤ëŠ˜ ìš´ë™ ì €ì¥</button>
  </div>

  <!-- ì €ì¥ëœ ê¸°ë¡ -->
  <div class="section-title" style="margin-top:24px">ì €ì¥ëœ ìš´ë™ ê¸°ë¡</div>
  <div id="logAccordion" style="display:flex;flex-direction:column;gap:12px;"></div>

  <!-- ë°±ì—…/ë³µì› ë²„íŠ¼ -->
  <div style="margin-top:20px;display:flex;flex-direction:column;gap:10px;">
    <button class="btn-ghost" onclick="downloadBackup()">ğŸ’¾ ê¸°ë¡ ë°±ì—… (JSON ì €ì¥)</button>
    <input type="file" id="fileInput" style="display:none" accept=".json">
    <button class="btn-ghost" onclick="uploadBackup()">ğŸ“ ë°±ì—… ë¶ˆëŸ¬ì˜¤ê¸° (JSON)</button>
  </div>

</div>

<script>
  /* -----------------------------
     ì €ì¥ ê´€ë ¨ í•µì‹¬: ì ˆëŒ€ ì•ˆ ë‚ ì•„ê°€ê²Œ ë§Œë“œëŠ” ë²„ì „
  ------------------------------*/

  const STORAGE_KEY = "workout_log_data";  // ê³ ì • (ë³€ê²½ ê¸ˆì§€)

  const CONFIG={
    "ìŠ¤ì¿¼íŠ¸":"weight",
    "ë ˆê·¸ ìµìŠ¤í…ì…˜":"weight",
    "ë¼ì‰ ë ˆê·¸ì»¬":"weight",
    "íŒ©ë± í”Œë¼ì´":"weight",
    "í¬ëŸ°ì¹˜":"reps",
    "ë ˆê·¸ ë ˆì´ì¦ˆ":"reps",
    "í”Œë­í¬":"timeSet",
    "ìŠ¤í…ë°€":"time",
    "ì¸í„°ë²Œ ëŸ¬ë‹":"distance"
  };

  let todayEntries=[];
  let saved=[];

  function todayISO(){return new Date().toISOString().split("T")[0]}

  const dateInput=document.getElementById("dateInput");
  const dynamicInputs=document.getElementById("dynamicInputs");
  const exerciseSelect=document.getElementById("exerciseSelect");
  const todayArea=document.getElementById("todayArea");
  const logAccordion=document.getElementById("logAccordion");

  /* -----------------------------
     ë¡œì»¬ ì €ì¥ ë¶ˆëŸ¬ì˜¤ê¸° + ìë™ êµ¬ì¡° ë³€í™˜
  ------------------------------*/
  function loadSaved(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw){ saved=[]; return; }

    try{
      const data = JSON.parse(raw);

      // ğŸ”¥ ì˜ˆì „ êµ¬ì¡° ê°ì§€ â†’ ìƒˆ êµ¬ì¡°ë¡œ ìë™ ë³€í™˜
      if (Array.isArray(data) && data.length && data[0].entries) {
        saved = data.map(s => ({
          date: s.date,
          items: s.entries
        }));
        saveAll();
      }
      else {
        saved = data;
      }

    }catch(e){
      saved=[];
    }
  }

  function saveAll(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(saved));
  }

  /* -----------------------------
     ì…ë ¥ UI ë Œë”ë§
  ------------------------------*/
  function renderDynamicInputs(){
    const type=CONFIG[exerciseSelect.value];

    if(type==="weight"){
      dynamicInputs.innerHTML=`
        <label>ì¤‘ëŸ‰ / ì„¸íŠ¸ / íšŸìˆ˜</label>
        <div class="inline-group">
          <input id="weight" type="number" placeholder="kg">
          <input id="sets" type="number" placeholder="ì„¸íŠ¸">
          <input id="reps" type="number" placeholder="íšŸìˆ˜">
        </div>`;
    }
    else if(type==="reps"){
      dynamicInputs.innerHTML=`
        <label>ì„¸íŠ¸ / íšŸìˆ˜</label>
        <div class="inline-group">
          <input id="sets" type="number" placeholder="ì„¸íŠ¸">
          <input id="reps" type="number" placeholder="íšŸìˆ˜">
        </div>`;
    }
    else if(type==="time"){
      dynamicInputs.innerHTML=`
        <label>ì‹œê°„(ë¶„)</label>
        <input id="time" type="number" placeholder="ë¶„">`;
    }
    else if(type==="distance"){
      dynamicInputs.innerHTML=`
        <label>ê±°ë¦¬ / ì‹œê°„</label>
        <div class="inline-group">
          <input id="distance" type="number" step="0.1" placeholder="km">
          <input id="time" type="number" placeholder="ë¶„">
        </div>`;
    }
    else if(type==="timeSet"){
      dynamicInputs.innerHTML=`
        <label>ì„¸íŠ¸ / ì‹œê°„(ë¶„)</label>
        <div class="inline-group">
          <input id="sets" type="number" placeholder="ì„¸íŠ¸">
          <input id="time" type="number" placeholder="ë¶„">
        </div>`;
    }
  }

  /* -----------------------------
     ì˜¤ëŠ˜ ìš´ë™ ì¶”ê°€
  ------------------------------*/
  function addEntry(){
    const ex = exerciseSelect.value;
    const type = CONFIG[ex];

    let weight=null,sets=null,reps=null,time=null,dist=null;

    if(type==="weight"){
      weight=+document.getElementById("weight").value;
      sets=+document.getElementById("sets").value;
      reps=+document.getElementById("reps").value;
      if(!weight||!sets||!reps)return alert("ì¤‘ëŸ‰/ì„¸íŠ¸/íšŸìˆ˜ ì…ë ¥");
    }
    else if(type==="reps"){
      sets=+document.getElementById("sets").value;
      reps=+document.getElementById("reps").value;
      if(!sets||!reps)return alert("ì„¸íŠ¸/íšŸìˆ˜ ì…ë ¥");
    }
    else if(type==="time"){
      time=+document.getElementById("time").value;
      if(!time)return alert("ì‹œê°„ ì…ë ¥");
    }
    else if(type==="distance"){
      dist=+document.getElementById("distance").value;
      time=+document.getElementById("time").value;
      if(!dist||!time)return alert("ê±°ë¦¬/ì‹œê°„ ì…ë ¥");
    }
    else if(type==="timeSet"){
      sets=+document.getElementById("sets").value;
      time=+document.getElementById("time").value;
      if(!sets||!time)return alert("ì„¸íŠ¸/ì‹œê°„ ì…ë ¥");
    }

    todayEntries.push({ ex,type,weight,sets,reps,time,dist });
    renderToday();
    renderDynamicInputs();
  }

  /* ì˜¤ëŠ˜ ìš´ë™ í‘œì‹œ */
  function renderToday(){
    if(!todayEntries.length){
      todayArea.textContent="ì•„ì§ ì¶”ê°€ëœ ìš´ë™ ì—†ìŒ";
      return;
    }

    todayArea.innerHTML=todayEntries.map(e=>{
      let v="-";
      if(e.type==="weight")v=`${e.weight}kg`;
      else if(e.type==="time")v=`${e.time}ë¶„`;
      else if(e.type==="distance")v=`${e.dist}km / ${e.time}ë¶„`;
      else if(e.type==="timeSet")v=`${e.time}ë¶„`;

      let sr="-";
      if(e.sets&&e.reps)sr=`${e.sets}Ã—${e.reps}`;
      else if(e.sets)sr=`${e.sets}ì„¸íŠ¸`;
      else if(e.reps)sr=`${e.reps}íšŒ`;

      return `<div>${e.ex} â€” ${v} â€” ${sr}</div>`;
    }).join("");
  }

  /* -----------------------------
     ì €ì¥ (ì˜êµ¬)
  ------------------------------*/
  function finishDay(){
    if(!todayEntries.length)return alert("ì˜¤ëŠ˜ ìš´ë™ ì—†ìŒ");

    saved.push({
      date:dateInput.value,
      items:todayEntries
    });

    saveAll();
    todayEntries=[];
    renderToday();
    renderSaved();
    alert("ì €ì¥ ì™„ë£Œ!");
  }

  /* -----------------------------
     ë‚ ì§œë³„ ê·¸ë£¹í™” + ì•„ì½”ë””ì–¸ ë Œë”ë§
  ------------------------------*/
  function renderSaved(){
    logAccordion.innerHTML="";

    if(!saved.length){
      logAccordion.innerHTML=`<div style="color:#6b7280">ê¸°ë¡ ì—†ìŒ</div>`;
      return;
    }

    const sorted=[...saved].sort((a,b)=>b.date.localeCompare(a.date));

    sorted.forEach(session=>{
      const head=document.createElement("div");
      head.className="accordion-date";
      head.innerHTML=`${session.date}<span>â–¶</span>`;

      const content=document.createElement("div");
      content.className="accordion-content";

      /* ê·¸ë£¹í™” */
      const groups={};
      session.items.forEach(e=>{
        if(!groups[e.ex])groups[e.ex]=[];
        groups[e.ex].push(e);
      });

      Object.keys(groups).forEach(name=>{
        const box=document.createElement("div");
        box.className="exercise-group";

        const title=document.createElement("div");
        title.className="exercise-title";
        title.textContent=name;
        box.appendChild(title);

        groups[name].forEach(e=>{
          let v="-";
          if(e.type==="weight")v=`${e.weight}kg`;
          else if(e.type==="time")v=`${e.time}ë¶„`;
          else if(e.type==="distance")v=`${e.dist}km / ${e.time}ë¶„`;
          else if(e.type==="timeSet")v=`${e.time}ë¶„`;

          let sr="-";
          if(e.sets&&e.reps)sr=`${e.sets}Ã—${e.reps}`;
          else if(e.sets)sr=`${e.sets}ì„¸íŠ¸`;
          else if(e.reps)sr=`${e.reps}íšŒ`;

          const line=document.createElement("div");
          line.className="exercise-line";
          line.textContent=`â€¢ ${v} â€” ${sr}`;
          box.appendChild(line);
        });

        content.appendChild(box);
      });

      head.onclick=()=>{
        const open=content.style.display==="flex";
        content.style.display=open?"none":"flex";
        head.querySelector("span").textContent=open?"â–¶":"â–¼";
      };

      logAccordion.appendChild(head);
      logAccordion.appendChild(content);
    });
  }

  /* -----------------------------
     JSON ë°±ì—… / ë³µì›
  ------------------------------*/
  function downloadBackup(){
    const blob=new Blob([JSON.stringify(saved,null,2)],{type:"application/json"});
    const url=URL.createObjectURL(blob);

    const a=document.createElement("a");
    a.href=url;
    a.download="workout_backup.json";
    a.click();
    URL.revokeObjectURL(url);
  }

  function uploadBackup(){
    document.getElementById("fileInput").click();

    document.getElementById("fileInput").onchange=(e)=>{
      const file=e.target.files[0];
      if(!file)return;

      const reader=new FileReader();
      reader.onload=(ev)=>{
        try{
          const data=JSON.parse(ev.target.result);

          if(!Array.isArray(data)) return alert("ì˜ëª»ëœ ë°±ì—… íŒŒì¼");

          saved=data;
          saveAll();
          renderSaved();
          alert("ë³µì› ì™„ë£Œ!");
        }catch(err){
          alert("íŒŒì¼ ì½ê¸° ì˜¤ë¥˜");
        }
      };
      reader.readAsText(file);
    };
  }

  /* ----------------------------- */
  /* ì´ˆê¸° ì‹¤í–‰ */
  /* ----------------------------- */
  dateInput.value=todayISO();
  loadSaved();
  renderDynamicInputs();
  renderSaved();

  exerciseSelect.onchange=renderDynamicInputs;
  document.getElementById("addEntryBtn").onclick=addEntry;
  document.getElementById("clearCurrentBtn").onclick=renderDynamicInputs;
  document.getElementById("clearTodayBtn").onclick=()=>{todayEntries=[];renderToday()};
  document.getElementById("finishDayBtn").onclick=finishDay;

</script>
</body>
</html>
