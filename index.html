<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json" />
  <title>workout Log</title>

  <style>
    :root {
      --bg: #f3f4f6;
      --card: #ffffff;
      --text: #111;
      --border: #d1d5db;
      --point: #2563eb;
    }
    :root.dark {
      --bg: #121212;
      --card: #1e1e1e;
      --text: #f3f4f6;
      --border: #3f3f3f;
      --point: #35357a;
    }

    body {
      margin:0; padding:20px;
      font-family: system-ui;
      background: var(--bg);
      color: var(--text);
      display:flex; justify-content:center;
      transition: .25s;
    }

    .container {
      width:100%;
      max-width:620px;
      background: var(--card);
      padding:20px;
      border-radius:12px;
      border:1px solid var(--border);
      position:relative;
    }

    #themeToggle {
      position:absolute;
      top:10px;
      right:10px;
      background:none;
      border:none;
      font-size:28px;
      cursor:pointer;
      color:var(--text);
      width:32px;
      height:32px;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    label { font-size:12px; margin-bottom:4px; display:block; }
    input, select {
      width:100%;
      padding:8px;
      border-radius:10px;
      border:1px solid var(--border);
      background:var(--card);
      color:var(--text);
      margin-bottom:8px;
    }

    button {
      width:100%;
      padding:10px;
      border-radius:10px;
      font-weight:600;
      margin-top:6px;
      cursor:pointer;
      border:none;
      font-size:14px;
    }

    .btn-primary { background:var(--point); color:white; }
    .btn-ghost { background:var(--card); border:1px solid var(--border); color:var(--text); }

    .accordion-date {
      background:#eef2ff;
      border:1px solid #c7d2fe;
      padding:10px;
      border-radius:10px;
      margin-top:12px;
      font-weight:600;
      display:flex;
      justify-content:space-between;
      cursor:pointer;
      color:#35357a;
    }
    :root.dark .accordion-date {
      background:#26284a;
      border-color:#3a3c62;
      color:#d6d7ff;
    }

    .accordion-content {
      display:none;
      flex-direction:column;
      gap:8px;
      padding:12px;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:10px;
    }

    .exercise-group {
      padding:8px;
      border:1px solid var(--border);
      border-radius:8px;
    }

    .exercise-line {
      display:flex;
      justify-content:space-between;
    }
    .edit-btn { color:#4e6ee9; cursor:pointer; font-size:12px; margin-right:8px; }
    .delete-btn { color:#dc2626; cursor:pointer; font-size:12px; }
  </style>
</head>

<body>

<div class="container">

  <button id="themeToggle">ğŸŒ™</button>

  <h1>Workout Log</h1>

  <label>ë‚ ì§œ</label>
  <input type="date" id="dateInput">

  <label>ìš´ë™ ì„ íƒ</label>
  <select id="exerciseSelect">
    <option>ìŠ¤ì¿¼íŠ¸</option>
    <option>ë ˆê·¸ ìµìŠ¤í…ì…˜</option>
    <option>ë¼ì‰ ë ˆê·¸ì»¬</option>
    <option>íŒ©ë± í”Œë¼ì´</option>
    <option>í¬ëŸ°ì¹˜</option>
    <option>ë ˆê·¸ ë ˆì´ì¦ˆ</option>
    <option>í”Œë­í¬</option>
    <option>ìŠ¤í…ë°€</option>
    <option>ì¸í„°ë²Œ ëŸ¬ë‹</option>
    <option value="custom">ê·¸ ì™¸ ìš´ë™ (ì§ì ‘ ì…ë ¥)</option>
  </select>

  <div id="dynamicInputs"></div>

  <button class="btn-primary" id="addEntryBtn">í‘œì— ì¶”ê°€</button>

  <h3 style="margin-top:20px;">ì˜¤ëŠ˜ ìš´ë™</h3>
  <div id="todayArea" style="min-height:40px;">ì•„ì§ ì¶”ê°€ëœ ìš´ë™ ì—†ìŒ</div>

  <button class="btn-ghost" id="clearTodayBtn">ì˜¤ëŠ˜ ìš´ë™ ë¹„ìš°ê¸°</button>
  <button class="btn-primary" id="finishDayBtn">ì˜¤ëŠ˜ ìš´ë™ ì €ì¥</button>

  <h3 style="margin-top:20px;">ì €ì¥ëœ ìš´ë™ ê¸°ë¡</h3>
  <div id="logAccordion"></div>

  <button class="btn-ghost" id="backupBtn">ë°±ì—…(JSON)</button>
  <button class="btn-ghost" id="restoreBtn">ë³µì›(JSON)</button>
  <input type="file" id="restoreInput" accept=".json" style="display:none">

</div>

<script>
/* -------------------- ë‹¤í¬ ëª¨ë“œ -------------------- */
const root = document.documentElement;
const themeToggle = document.getElementById("themeToggle");

if (localStorage.getItem("theme") === "dark") {
  root.classList.add("dark");
  themeToggle.textContent = "â˜€ï¸";
}
themeToggle.onclick = () => {
  root.classList.toggle("dark");
  const mode = root.classList.contains("dark") ? "dark" : "light";
  localStorage.setItem("theme", mode);
  themeToggle.textContent = mode === "dark" ? "â˜€ï¸" : "ğŸŒ™";
};

/* -------------------- ê¸°ë³¸ ì„¤ì • -------------------- */
let todayEntries = [];
let saved = [];
let editTarget = null;

const STORAGE_KEY = "workout_log_single";
dateInput.value = new Date().toISOString().split("T")[0];

const CONFIG = {
  "ìŠ¤ì¿¼íŠ¸":"weight",
  "ë ˆê·¸ ìµìŠ¤í…ì…˜":"weight",
  "ë¼ì‰ ë ˆê·¸ì»¬":"weight",
  "íŒ©ë± í”Œë¼ì´":"weight",
  "í¬ëŸ°ì¹˜":"repsOnly",
  "ë ˆê·¸ ë ˆì´ì¦ˆ":"repsOnly",
  "í”Œë­í¬":"plank",
  "ìŠ¤í…ë°€":"time",
  "ì¸í„°ë²Œ ëŸ¬ë‹":"distanceOnly"
};

function renderDynamicInputs() {
  const type = CONFIG[exerciseSelect.value];
  const box = dynamicInputs;

  if (exerciseSelect.value === "custom") {
    box.innerHTML = `
      <label>ìš´ë™ëª…</label>
      <input id="c_name" type="text">

      <label>ì¤‘ëŸ‰/ì„¸íŠ¸/íšŸìˆ˜</label>
      <div>
        <input id="c_weight" type="number" placeholder="kg">
        <input id="c_sets" type="number" placeholder="ì„¸íŠ¸">
        <input id="c_reps" type="number" placeholder="íšŸìˆ˜">
      </div>

      <label>ê±°ë¦¬(km)</label>
      <input id="c_dist" type="number">

      <label>ì‹œê°„</label>
      <div>
        <input id="c_min" type="number" placeholder="ë¶„">
        <input id="c_sec" type="number" placeholder="ì´ˆ">
      </div>
    `;
    return;
  }

  if (type === "weight") {
    box.innerHTML = `
      <label>ì¤‘ëŸ‰/ì„¸íŠ¸/íšŸìˆ˜</label>
      <div>
        <input id="weight" type="number" placeholder="kg">
        <input id="sets" type="number" placeholder="ì„¸íŠ¸">
        <input id="reps" type="number" placeholder="íšŸìˆ˜">
      </div>`;
  }
  else if (type === "repsOnly") {
    box.innerHTML = `
      <label>ì„¸íŠ¸/íšŸìˆ˜</label>
      <div>
        <input id="sets" type="number" placeholder="ì„¸íŠ¸">
        <input id="reps" type="number" placeholder="íšŸìˆ˜">
      </div>`;
  }
  else if (type === "plank") {
    box.innerHTML = `
      <label>ì„¸íŠ¸/ì´ˆ</label>
      <div>
        <input id="sets" type="number" placeholder="ì„¸íŠ¸">
        <input id="seconds" type="number" placeholder="ì´ˆ">
      </div>`;
  }
  else if (type === "time") {
    box.innerHTML = `
      <label>ì‹œê°„(ë¶„)</label>
      <input id="time" type="number">

      <label>ë©”ëª¨</label>
      <input id="memo" type="text" placeholder="ì˜ˆ: ê²½ì‚¬ 8%">
    `;
  }
  else if (type === "distanceOnly") {
    box.innerHTML = `
      <label>ê±°ë¦¬(km)</label>
      <input id="distance" type="number">

      <label>ë©”ëª¨</label>
      <input id="memo" type="text" placeholder="ì˜ˆ: 6â†’9 íŒ¨í„´">
    `;
  }
}
renderDynamicInputs();
exerciseSelect.onchange = renderDynamicInputs;

/* -------------------- ì¶”ê°€ & ìˆ˜ì • ì €ì¥ -------------------- */
addEntryBtn.onclick = () => {
  const selected = exerciseSelect.value;
  let entry = {};

  if (selected === "custom") {
    entry = {
      ex: c_name.value,
      custom: true,
      weight: +c_weight.value || null,
      sets: +c_sets.value || null,
      reps: +c_reps.value || null,
      dist: +c_dist.value || null,
      timeMin: +c_min.value || null,
      timeSec: +c_sec.value || null,
      memo: null
    };
  } else {
    const type = CONFIG[selected];
    entry.ex = selected;
    entry.type = type;

    if (type === "weight") {
      entry.weight = +weight.value;
      entry.sets = +sets.value;
      entry.reps = +reps.value;
    }
    if (type === "repsOnly") {
      entry.sets = +sets.value;
      entry.reps = +reps.value;
    }
    if (type === "plank") {
      entry.sets = +sets.value;
      entry.seconds = +seconds.value;
    }
    if (type === "time") {
      entry.time = +time.value;
      entry.memo = memo.value || null;
    }
    if (type === "distanceOnly") {
      entry.dist = +distance.value;
      entry.memo = memo.value || null;
    }
  }

  /* ìˆ˜ì • ì €ì¥ ëª¨ë“œ */
  if (editTarget) {
    saved[editTarget.di].items[editTarget.ii] = entry;
    store();
    renderSaved();
    editTarget = null;
    addEntryBtn.textContent = "í‘œì— ì¶”ê°€";
    renderDynamicInputs();
    return;
  }

  /* ì¼ë°˜ ì¶”ê°€ */
  todayEntries.push(entry);
  renderToday();
  renderDynamicInputs();
};

/* -------------------- ì˜¤ëŠ˜ ìš´ë™ í‘œì‹œ -------------------- */
function renderToday() {
  if (!todayEntries.length) {
    todayArea.textContent = "ì•„ì§ ì¶”ê°€ëœ ìš´ë™ ì—†ìŒ";
    return;
  }
  todayArea.innerHTML = todayEntries.map(e => formatEntry(e)).join("<br>");
}

/* -------------------- í¬ë§· -------------------- */
function formatEntry(e) {
  let out = `${e.ex} â€” `;
  if (e.custom) {
    if (e.weight) out += `${e.weight}kg `;
    if (e.sets && e.reps) out += `${e.sets}Ã—${e.reps} `;
    if (e.dist) out += `${e.dist}km `;
    if (e.timeMin) out += `${e.timeMin}ë¶„ `;
    if (e.timeSec) out += `${e.timeSec}ì´ˆ `;
  } else {
    if (e.type === "weight") out += `${e.weight}kg ${e.sets}Ã—${e.reps}`;
    if (e.type === "repsOnly") out += `${e.sets}Ã—${e.reps}`;
    if (e.type === "plank") out += `${e.sets}Ã—${e.seconds}ì´ˆ`;
    if (e.type === "time") out += `${e.time}ë¶„`;
    if (e.type === "distanceOnly") out += `${e.dist}km`;
  }
  if (e.memo) out += ` (${e.memo})`;
  return out;
}

/* -------------------- ì˜¤ëŠ˜ ìš´ë™ ì €ì¥ -------------------- */
finishDayBtn.onclick = () => {
  if (!todayEntries.length) return;
  const date = dateInput.value;

  let exist = saved.find(s => s.date === date);
  if (exist) exist.items.push(...todayEntries);
  else saved.push({ date, items: [...todayEntries] });

  todayEntries = [];
  store();
  renderToday();
  renderSaved();
};

/* -------------------- ì €ì¥/ë¡œë“œ -------------------- */
function store() {
  saved.sort((a,b)=> b.date.localeCompare(a.date));
  localStorage.setItem(STORAGE_KEY, JSON.stringify(saved));
}
function load() {
  saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
}
load();

/* -------------------- ì €ì¥ëœ ê¸°ë¡ ë Œë” -------------------- */
function renderSaved() {
  logAccordion.innerHTML = "";
  saved.forEach((session, di) => {
    const head = document.createElement("div");
    head.className="accordion-date";
    head.innerHTML=`${session.date}<span>â–¶</span>`;

    const content = document.createElement("div");
    content.className="accordion-content";

    const groups = {};
    session.items.forEach((e, ii) => {
      if (!groups[e.ex]) groups[e.ex] = [];
      groups[e.ex].push({e, ii});
    });

    Object.keys(groups).forEach(ex => {
      const box=document.createElement("div");
      box.className="exercise-group";
      box.innerHTML+=`<div>${ex}</div>`;

      groups[ex].forEach(obj => {
        const line=document.createElement("div");
        line.className="exercise-line";
        line.innerHTML=`
          <span>${formatEntry(obj.e)}</span>
          <span>
            <span class="edit-btn" onclick="editEntry(${di}, ${obj.ii})">ìˆ˜ì •</span>
            <span class="delete-btn" onclick="deleteEntry(${di}, ${obj.ii})">ì‚­ì œ</span>
          </span>
        `;
        box.appendChild(line);
      });

      content.appendChild(box);
    });

    head.onclick=()=>{
      content.style.display = content.style.display==="flex" ? "none" : "flex";
    };

    logAccordion.appendChild(head);
    logAccordion.appendChild(content);
  });
}
renderSaved();

/* -------------------- ìˆ˜ì • ê¸°ëŠ¥ -------------------- */
function editEntry(di, ii) {
  const e = saved[di].items[ii];
  editTarget = {di, ii};

  exerciseSelect.value = e.ex;
  renderDynamicInputs();

  if (e.type==="weight") {
    weight.value=e.weight;
    sets.value=e.sets;
    reps.value=e.reps;
  }
  if (e.type==="repsOnly") {
    sets.value=e.sets;
    reps.value=e.reps;
  }
  if (e.type==="plank") {
    sets.value=e.sets;
    seconds.value=e.seconds;
  }
  if (e.type==="time") {
    time.value=e.time;
    if (memo) memo.value=e.memo||"";
  }
  if (e.type==="distanceOnly") {
    distance.value=e.dist;
    if (memo) memo.value=e.memo||"";
  }

  addEntryBtn.textContent="ìˆ˜ì • ì €ì¥";
}

/* -------------------- ì‚­ì œ ê¸°ëŠ¥ -------------------- */
function deleteEntry(di, ii) {
  if (!confirm("ì´ í•­ëª©ì„ ì‚­ì œí• ê¹Œìš”?")) return;

  saved[di].items.splice(ii,1);
  if (!saved[di].items.length) saved.splice(di,1);

  store();
  renderSaved();
}

/* -------------------- ì˜¤ëŠ˜ ë¹„ìš°ê¸° -------------------- */
clearTodayBtn.onclick = ()=>{
  todayEntries=[];
  renderToday();
};

/* -------------------- ë°±ì—…(JSON) -------------------- */
backupBtn.onclick = ()=>{
  const blob = new Blob([JSON.stringify({saved}, null, 2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;
  a.download="workout_backup.json";
  a.click();
  URL.revokeObjectURL(url);
};

/* -------------------- ë³µì›(JSON) -------------------- */
restoreBtn.onclick=()=> restoreInput.click();

restoreInput.onchange = e=>{
  const file=e.target.files[0];
  if (!file) return;

  const reader=new FileReader();
  reader.onload=()=>{
    try {
      const json=JSON.parse(reader.result);
      if (!json.saved) return alert("JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");

      saved=json.saved;
      store();
      renderSaved();
      alert("ë³µì› ì™„ë£Œ!");
    } catch {
      alert("ë³µì› ì‹¤íŒ¨ (JSON ì˜¤ë¥˜)");
    }
  };
  reader.readAsText(file);
};
</script>

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>

