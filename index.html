<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>workout Log</title>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2563eb">

  <style>
    *{box-sizing:border-box}
    body{
      margin:0;padding:20px;
      font-family:system-ui,-apple-system,"Segoe UI",sans-serif;
      background:#f3f4f6;
      display:flex;justify-content:center;
    }
    .container{
      width:100%;max-width:600px;
      background:#fff;border-radius:12px;
      padding:18px 20px 28px;
      box-shadow:0 16px 28px rgba(0,0,0,0.12);
      border:1px solid #e5e7eb;
    }
    h1{margin:0;color:#111827;font-size:22px}

    label{font-size:12px;color:#374151}
    input,select{
      width:100%;border-radius:10px;
      border:1px solid #d1d5db;background:#fff;
      padding:8px;font-size:13px;
    }
    input:focus,select:focus{
      border-color:#2563eb;
      box-shadow:0 0 0 1px rgba(37,99,235,0.2);
      outline:none;
    }

    .section-title{margin-top:20px;margin-bottom:6px;font-weight:600}
    .card{
      background:#f9fafb;border:1px solid #e5e7eb;
      border-radius:12px;padding:14px;
    }
    .form-grid{
      display:grid;grid-template-columns:1fr 1fr;
      gap:12px;align-items:flex-end
    }
    .inline-group{display:flex;gap:6px}

    button{
      border:none;border-radius:10px;
      padding:10px;font-size:14px;
      font-weight:600;cursor:pointer;width:100%;
    }
    .btn-primary{background:#2563eb;color:#fff}
    .btn-ghost{background:#f9fafb;border:1px solid #d1d5db}

    .edit-btn{
      color:#2563eb;font-size:12px;
      cursor:pointer;margin-left:8px;
    }

    .accordion-date{
      padding:10px 14px;background:#eef2ff;
      border:1px solid #c7d2fe;border-radius:10px;
      font-weight:600;color:#1e3a8a;
      display:flex;justify-content:space-between;
      align-items:center;cursor:pointer;
    }
    .accordion-content{
      display:none;flex-direction:column;
      gap:8px;padding:12px;
      background:#fafafa;border:1px solid #e5e7eb;
      border-radius:10px;font-size:13px;
    }
    .exercise-group{
      background:#fff;border:1px solid #e5e7eb;
      border-radius:8px;padding:8px 10px;
    }
    .exercise-title{
      font-weight:600;margin-bottom:4px;
      color:#111827;font-size:14px;
    }
    .exercise-line{
      font-size:13px;color:#374151;
      margin-left:8px;display:flex;
      align-items:center;justify-content:space-between;
    }

    @media(max-width:480px){
      .form-grid{grid-template-columns:1fr}
      .inline-group{flex-direction:column}
      button{width:100%}
    }
  </style>
</head>

<body>
<div class="container">
  <h1>Workout Log</h1>

  <label>ë‚ ì§œ</label>
  <input type="date" id="dateInput" style="margin-bottom:14px">

  <div class="section-title">ì˜¤ëŠ˜ ìš´ë™ ì…ë ¥</div>
  <div class="card">
    <div class="form-grid">
      <div>
        <label>ìš´ë™ ì„ íƒ</label>
        <select id="exerciseSelect">
          <option>ìŠ¤ì¿¼íŠ¸</option>
          <option>ë ˆê·¸ ìµìŠ¤í…ì…˜</option>
          <option>ë¼ì‰ ë ˆê·¸ì»¬</option>
          <option>íŒ©ë± í”Œë¼ì´</option>
          <option>í¬ëŸ°ì¹˜</option>
          <option>ë ˆê·¸ ë ˆì´ì¦ˆ</option>
          <option>í”Œë­í¬</option>
          <option>ìŠ¤í…ë°€</option>
          <option>ì¸í„°ë²Œ ëŸ¬ë‹</option>
          <option value="custom">ê·¸ ì™¸ ìš´ë™ (ì§ì ‘ ì…ë ¥)</option>
        </select>
      </div>
      <div id="dynamicInputs"></div>
    </div>

    <div style="margin-top:10px;display:flex;flex-direction:column;gap:8px">
      <button class="btn-ghost" id="clearCurrentBtn">ì…ë ¥ ì´ˆê¸°í™”</button>
      <button class="btn-primary" id="addEntryBtn">í‘œì— ì¶”ê°€</button>
    </div>
  </div>

  <div class="section-title">ì˜¤ëŠ˜ ìš´ë™</div>
  <div id="todayArea" style="background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:10px;min-height:46px;font-size:14px;color:#374151">
    ì•„ì§ ì¶”ê°€ëœ ìš´ë™ ì—†ìŒ
  </div>

  <div style="margin-top:10px;display:flex;flex-direction:column;gap:8px;">
    <button class="btn-ghost" id="clearTodayBtn">ì˜¤ëŠ˜ ìš´ë™ ë¹„ìš°ê¸°</button>
    <button class="btn-primary" id="finishDayBtn">ì˜¤ëŠ˜ ìš´ë™ ì €ì¥</button>
    <button class="btn-ghost" onclick="backupData()">ë°±ì—…(JSON)</button>
    <button class="btn-ghost" onclick="restoreData()">ë³µì›(JSON)</button>
    <input type="file" id="restoreInput" accept=".json" style="display:none" />
  </div>

  <div class="section-title" style="margin-top:24px">ì €ì¥ëœ ìš´ë™ ê¸°ë¡</div>
  <div id="logAccordion" style="display:flex;flex-direction:column;gap:12px;"></div>

</div>

<script>
/* -------- ë¡œì»¬ ì €ì¥ -------- */
const STORAGE_KEY="workout_log_single_user";

let todayEntries=[];
let saved=[];
let editTarget=null;

/* ë‚ ì§œ ê¸°ë³¸ê°’ */
document.getElementById("dateInput").value=new Date().toISOString().split("T")[0];

/* ê¸°ë³¸ ìš´ë™ ìœ í˜• */
const CONFIG={
  "ìŠ¤ì¿¼íŠ¸":"weight",
  "ë ˆê·¸ ìµìŠ¤í…ì…˜":"weight",
  "ë¼ì‰ ë ˆê·¸ì»¬":"weight",
  "íŒ©ë± í”Œë¼ì´":"weight",
  "í¬ëŸ°ì¹˜":"repsOnly",
  "ë ˆê·¸ ë ˆì´ì¦ˆ":"repsOnly",
  "í”Œë­í¬":"plank",
  "ìŠ¤í…ë°€":"time",
  "ì¸í„°ë²Œ ëŸ¬ë‹":"distanceOnly"
};

/* ë™ì  ì…ë ¥ */
function renderDynamicInputs(){
  const val=document.getElementById("exerciseSelect").value;
  const box=document.getElementById("dynamicInputs");

  // ğŸ”¹ â€œê·¸ ì™¸ ìš´ë™â€ UI
  if(val==="custom"){
    box.innerHTML=`
      <label>ìš´ë™ëª…</label>
      <input id="customName" type="text" placeholder="ìš´ë™ ì´ë¦„ ì…ë ¥">

      <label style="margin-top:8px">ì¤‘ëŸ‰ / ì„¸íŠ¸ / íšŸìˆ˜</label>
      <div class="inline-group">
        <input id="c_weight" type="number" placeholder="kg">
        <input id="c_sets" type="number" placeholder="ì„¸íŠ¸">
        <input id="c_reps" type="number" placeholder="íšŸìˆ˜">
      </div>

      <label style="margin-top:8px">ê±°ë¦¬ (km)</label>
      <input id="c_dist" type="number" step="0.1" placeholder="km">

      <label style="margin-top:8px">ì‹œê°„</label>
      <div class="inline-group">
        <input id="c_minutes" type="number" placeholder="ë¶„">
        <input id="c_seconds" type="number" placeholder="ì´ˆ">
      </div>
    `;
    return;
  }

  // ğŸ”¹ ê¸°ì¡´ ìš´ë™ UI
  const type=CONFIG[val];

  if(type==="weight"){
    box.innerHTML=`
      <label>ì¤‘ëŸ‰ / ì„¸íŠ¸ / íšŸìˆ˜</label>
      <div class="inline-group">
        <input id="weight" type="number" placeholder="kg">
        <input id="sets" type="number" placeholder="ì„¸íŠ¸">
        <input id="reps" type="number" placeholder="íšŸìˆ˜">
      </div>`;
  }
  else if(type==="repsOnly"){
    box.innerHTML=`
      <label>ì„¸íŠ¸ / íšŸìˆ˜</label>
      <div class="inline-group">
        <input id="sets" type="number" placeholder="ì„¸íŠ¸">
        <input id="reps" type="number" placeholder="íšŸìˆ˜">
      </div>`;
  }
  else if(type==="plank"){
    box.innerHTML=`
      <label>ì„¸íŠ¸ / ì‹œê°„(ì´ˆ)</label>
      <div class="inline-group">
        <input id="sets" type="number" placeholder="ì„¸íŠ¸">
        <input id="seconds" type="number" placeholder="ì´ˆ">
      </div>`;
  }
  else if(type==="time"){
    box.innerHTML=`
      <label>ì‹œê°„(ë¶„)</label>
      <input id="time" type="number" placeholder="ë¶„">`;
  }
  else if(type==="distanceOnly"){
    box.innerHTML=`
      <label>ê±°ë¦¬ (km)</label>
      <input id="distance" type="number" placeholder="km">`;
  }
}
renderDynamicInputs();

/* -------- ì˜¤ëŠ˜ ìš´ë™ ì¶”ê°€ -------- */
function addEntry(){
  const exSel=document.getElementById("exerciseSelect").value;

  let entry={};

  /* ğŸ”¹ ì»¤ìŠ¤í…€ ìš´ë™ */
  if(exSel==="custom"){
    const name=document.getElementById("customName").value.trim();
    if(!name) return alert("ìš´ë™ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.");

    entry.ex=name;
    entry.custom=true;

    entry.weight=+document.getElementById("c_weight").value||null;
    entry.sets=+document.getElementById("c_sets").value||null;
    entry.reps=+document.getElementById("c_reps").value||null;

    entry.dist=+document.getElementById("c_dist").value||null;

    entry.timeMin=+document.getElementById("c_minutes").value||null;
    entry.timeSec=+document.getElementById("c_seconds").value||null;

  } else {
    /* ğŸ”¹ ê¸°ì¡´ ìš´ë™ */
    const ex=document.getElementById("exerciseSelect").value;
    const type=CONFIG[ex];

    entry.ex=ex;
    entry.type=type;

    if(type==="weight"){
      entry.weight=+weight.value;
      entry.sets=+sets.value;
      entry.reps=+reps.value;
      if(!entry.weight||!entry.sets||!entry.reps) return alert("ì…ë ¥ í•„ìš”");
    }
    if(type==="repsOnly"){
      entry.sets=+sets.value;
      entry.reps=+reps.value;
      if(!entry.sets||!entry.reps) return alert("ì…ë ¥ í•„ìš”");
    }
    if(type==="plank"){
      entry.sets=+sets.value;
      entry.seconds=+seconds.value;
      if(!entry.sets||!entry.seconds) return alert("ì…ë ¥ í•„ìš”");
    }
    if(type==="time"){
      entry.time=+time.value;
      if(!entry.time) return alert("ì…ë ¥ í•„ìš”");
    }
    if(type==="distanceOnly"){
      entry.dist=+distance.value;
      if(!entry.dist) return alert("ì…ë ¥ í•„ìš”");
    }
  }

  /* í¸ì§‘ */
  if(editTarget){
    saved[editTarget.dateIndex].items[editTarget.itemIndex]=entry;
    saveLocal();
    editTarget=null;
    document.getElementById("addEntryBtn").textContent="í‘œì— ì¶”ê°€";
    renderSaved();
    return;
  }

  todayEntries.push(entry);
  renderToday();
  renderDynamicInputs();
}

/* -------- í¬ë§·íŒ… -------- */
function formatEntry(e){
  if(e.custom){
    let result=e.ex+" â€” ";

    if(e.weight) result+=`${e.weight}kg `;
    if(e.sets&&e.reps) result+=`${e.sets}Ã—${e.reps} `;
    if(e.dist) result+=`${e.dist}km `;
    if(e.timeMin) result+=`${e.timeMin}ë¶„ `;
    if(e.timeSec) result+=`${e.timeSec}ì´ˆ `;

    return `<div>${result.trim()}</div>`;
  }

  let v=null, sr=null;
  if(e.type==="weight") v=`${e.weight}kg`;
  if(e.type==="time") v=`${e.time}ë¶„`;
  if(e.type==="distanceOnly") v=`${e.dist}km`;

  if(e.type==="plank") sr=`${e.sets}Ã—${e.seconds}ì´ˆ`;
  else if(e.sets&&e.reps) sr=`${e.sets}Ã—${e.reps}`;

  return `<div>${e.ex} â€” ${v?v+" ":""}${sr?sr:""}</div>`;
}

function renderToday(){
  const box=document.getElementById("todayArea");
  if(!todayEntries.length){
    box.textContent="ì•„ì§ ì¶”ê°€ëœ ìš´ë™ ì—†ìŒ";
    return;
  }
  box.innerHTML=todayEntries.map(e=>formatEntry(e)).join("");
}

/* -------- ì €ì¥ -------- */
function finishDay(){
  if(!todayEntries.length) return alert("ì˜¤ëŠ˜ ìš´ë™ ì—†ìŒ");
  
  const date=document.getElementById("dateInput").value;
  let day=saved.find(s=>s.date===date);

  if(day) day.items.push(...todayEntries);
  else saved.push({date,items:[...todayEntries]});

  saveLocal();
  todayEntries=[];
  renderToday();
  renderSaved();
}

function saveLocal(){
  localStorage.setItem(STORAGE_KEY,JSON.stringify(saved));
}
function loadLocal(){
  saved=JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]");
}
loadLocal();

/* -------- ê¸°ë¡ í‘œì‹œ -------- */
function renderSaved(){
  const acc=document.getElementById("logAccordion");
  acc.innerHTML="";

  if(!saved.length){
    acc.innerHTML=`<div style="color:#6b7280">ê¸°ë¡ ì—†ìŒ</div>`;
    return;
  }

  [...saved].sort((a,b)=>b.date.localeCompare(a.date))
  .forEach((session,di)=>{
    const head=document.createElement("div");
    head.className="accordion-date";
    head.innerHTML=`${session.date}<span>â–¶</span>`;

    const content=document.createElement("div");
    content.className="accordion-content";

    const groups={};
    session.items.forEach((e,ii)=>{
      const key=e.ex;
      if(!groups[key]) groups[key]=[];
      groups[key].push({...e,index:ii});
    });

    Object.keys(groups).forEach(name=>{
      const box=document.createElement("div");
      box.className="exercise-group";
      box.innerHTML=`<div class="exercise-title">${name}</div>`;

      groups[name].forEach(e=>{
        const line=document.createElement("div");
        line.className="exercise-line";
        line.innerHTML=`
          <span>${formatEntry(e)}</span>
          <span class="edit-btn" onclick="editEntry(${di},${e.index})">âœ ìˆ˜ì •</span>
        `;
        box.appendChild(line);
      });

      content.appendChild(box);
    });

    head.onclick=()=>{
      const open=content.style.display==="flex";
      content.style.display=open?"none":"flex";
      head.querySelector("span").textContent=open?"â–¶":"â–¼";
    };

    acc.appendChild(head);
    acc.appendChild(content);
  });
}
renderSaved();

/* -------- ìˆ˜ì • -------- */
function editEntry(di,ii){
  const e=saved[di].items[ii];

  if(e.custom){
    document.getElementById("exerciseSelect").value="custom";
    renderDynamicInputs();

    customName.value=e.ex;
    c_weight.value=e.weight||"";
    c_sets.value=e.sets||"";
    c_reps.value=e.reps||"";
    c_dist.value=e.dist||"";

    c_minutes.value=e.timeMin||"";
    c_seconds.value=e.timeSec||"";

  } else {
    document.getElementById("exerciseSelect").value=e.ex;
    renderDynamicInputs();

    if(e.type==="weight"){
      weight.value=e.weight;
      sets.value=e.sets;
      reps.value=e.reps;
    }
    if(e.type==="repsOnly"){
      sets.value=e.sets;
      reps.value=e.reps;
    }
    if(e.type==="plank"){
      sets.value=e.sets;
      seconds.value=e.seconds;
    }
    if(e.type==="time"){
      time.value=e.time;
    }
    if(e.type==="distanceOnly"){
      distance.value=e.dist;
    }
  }

  editTarget={dateIndex:di,itemIndex:ii};
  document.getElementById("addEntryBtn").textContent="ìˆ˜ì • ì €ì¥";
}

/* -------- ë°±ì—… / ë³µì› -------- */
function backupData(){
  const blob=new Blob([JSON.stringify({saved},null,2)],{type:"application/json"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;
  a.download=`workout_backup_${new Date().toISOString().split("T")[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
}
function restoreData(){document.getElementById("restoreInput").click();}
document.getElementById("restoreInput").addEventListener("change",e=>{
  const f=e.target.files[0];
  if(!f)return;
  const r=new FileReader();
  r.onload=()=>{
    try{
      saved=JSON.parse(r.result).saved||[];
      saveLocal();
      renderSaved();
      alert("ë³µì› ì™„ë£Œ!");
    }catch{alert("JSON ì˜¤ë¥˜");}
  };
  r.readAsText(f);
});
</script>

</body>
</html>
